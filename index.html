<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Map test</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js" type="text/javascript"></script>
  <style type="text/css">
     canvas { border: 1px solid black; }
     /* Inspired by http://demos.greghoustondesign.com/piechart/ */
     .canvasWrapper {
         position: relative;
     }
     .canvasWrapper img {
         left: 0px;
         top: 0px;
         position: absolute;
     }
     img {
         border: medium none;
     }
   </style>
</head>
<body>
    <h1>blah</h1>
    <div class="canvasWrapper">
        <canvas id="mapCanvas" width="800" height="495"></canvas>
        <img width="800" height="495" src="svg/spacer.gif" usemap="#mapMap" style="width: 800px; height: 495px;" alt="">
    </div>
        <map id="mapMap" name="mapMap">
            <area id="area0" href="http://www.google.com" title="abc" shape="poly" coords="200,200,500,200,500,500">
        </map>
  <script type="application/x-javascript">
if (!Array.prototype.map)
{
  Array.prototype.map = function(fun /*, thisp*/)
  {
    var len = this.length >>> 0;
    if (typeof fun != "function")
      throw new TypeError();

    var res = new Array(len);
    var thisp = arguments[1];
    for (var i = 0; i < len; i++)
    {
      if (i in this)
        res[i] = fun.call(thisp, this[i], i, this);
    }

    return res;
  };
}

    var ctx;
    var mapImage;
    // The general-purpose event handler. This function just determines the mouse 
    // position relative to the canvas element.
    function ev_canvas (ev) {
        if (ev.layerX || ev.layerX == 0) { // Firefox
            ev._x = ev.layerX;
            ev._y = ev.layerY;
        } else if (ev.offsetX || ev.offsetX == 0) { // Opera
            ev._x = ev.offsetX;
            ev._y = ev.offsetY;
        }
        alert('hit at ' + ev._x + ', ' + ev._y);
    }
    function imageLoaded() {
        ctx.drawImage(mapImage, 0, 0);
    }
var stateData = {'HI': "M 242.96145,653.59282 L 244.83646,650.1553 L 247.02397,649.8428 L 247.33647,650.62405 L 245.30521,653.59282 L 242.96145,653.59282 z M 252.80525,649.99905 L 258.74278,652.49906 L 260.77404,652.18656 L 262.33654,648.43654 L 261.71154,645.15528 L 257.64902,644.68653 L 253.74275,646.40528 L 252.80525,649.99905 z M 282.49289,659.6866 L 286.08665,664.99912 L 288.43041,664.68662 L 289.52417,664.21787 L 290.93042,665.46787 L 294.52419,665.31162 L 295.4617,663.90537 L 292.64918,662.18661 L 290.77417,658.59284 L 288.74291,655.15533 L 283.11789,657.96784 L 282.49289,659.6866 z M 302.02423,668.28039 L 303.27423,666.40538 L 307.8055,667.34288 L 308.43051,666.87413 L 314.36803,667.49913 L 314.05553,668.74914 L 311.55552,670.15539 L 307.33675,669.84289 L 302.02423,668.28039 z M 307.1805,673.28041 L 309.05551,677.03043 L 312.02427,675.93667 L 312.33677,674.37416 L 310.77427,672.3429 L 307.1805,672.0304 L 307.1805,673.28041 z M 313.89928,672.18665 L 316.08679,669.37414 L 320.61806,671.7179 L 324.83683,672.81166 L 329.0556,675.46792 L 329.0556,677.34293 L 325.61809,679.06169 L 320.93056,679.99919 L 318.5868,678.59293 L 313.89928,672.18665 z M 329.99311,687.18672 L 331.55561,685.93672 L 334.83688,687.49923 L 342.18066,690.93674 L 345.46193,692.968 L 347.02443,695.31176 L 348.89944,699.53053 L 352.80571,702.03054 L 352.49321,703.28055 L 348.74319,706.40556 L 344.68067,707.81182 L 343.27442,707.18682 L 340.30565,708.90557 L 337.96189,712.03059 L 335.77438,714.8431 L 334.05562,714.68685 L 330.61811,712.18684 L 330.30561,707.81182 L 330.93061,705.46806 L 329.3681,699.99928 L 327.33684,698.28052 L 327.18059,695.78051 L 329.3681,694.84301 L 331.39936,691.87425 L 331.86811,690.93674 L 330.30561,689.21798 L 329.99311,687.18672 z",
    'AK' : "M 171.40704,672.96791 L 173.7508,671.56165 L 172.8133,669.84289 L 171.09454,670.7804 L 171.40704,672.96791 z M 130.46935,692.18675 L 131.56311,697.81177 L 134.37562,698.59303 L 139.21939,695.78051 L 143.43816,693.2805 L 141.87566,690.93674 L 142.34441,688.59298 L 140.31315,689.84299 L 137.50064,689.06173 L 139.06314,687.96798 L 140.93815,688.74923 L 144.68817,687.03047 L 145.15692,685.62422 L 142.81316,684.84296 L 143.59441,682.96795 L 140.93815,684.84296 L 136.40688,688.28048 L 131.71936,691.09299 L 130.46935,692.18675 z M 122.03181,704.21805 L 123.43807,705.93681 L 124.37558,704.84306 L 123.59432,702.96805 L 122.03181,704.21805 z M 99.219209,706.09306 L 100.31296,703.90555 L 102.34422,704.21805 L 101.56297,706.09306 L 99.219209,706.09306 z M 96.406696,703.1243 L 97.969203,704.99931 L 100.00046,703.4368 L 98.594206,702.18679 L 96.406696,703.1243 z M 49.062727,707.49932 L 52.343992,705.31181 L 55.625257,704.3743 L 58.125269,704.6868 L 58.594021,706.24931 L 60.46903,706.71806 L 62.344038,704.84306 L 62.031537,703.28055 L 64.687799,702.65555 L 67.500312,705.15556 L 66.406557,706.87431 L 62.187788,707.96807 L 59.531525,707.49932 L 55.937759,706.40556 L 51.718989,707.81182 L 50.156482,708.12432 L 49.062727,707.49932 z M 62.344038,636.87399 L 63.437794,639.374 L 64.531549,640.93651 L 63.437794,641.71776 L 61.406534,638.749 L 61.406534,636.87399 L 62.344038,636.87399 z M 82.344131,650.4678 L 85.937898,651.24906 L 89.531664,652.18656 L 90.312918,653.12407 L 88.750411,656.71783 L 85.781647,656.56158 L 82.500382,653.12407 L 82.344131,650.4678 z M 84.844143,618.1239 L 86.875402,623.28018 L 86.719151,624.21768 L 83.906638,623.90518 L 82.18788,619.99891 L 80.469122,618.59266 L 78.125361,618.59266 L 77.969111,616.09264 L 79.687869,613.74888 L 80.781624,616.09264 L 82.18788,617.4989 L 84.844143,618.1239 z M 248.5949,718.59312 L 247.03239,717.81187 L 245.62614,714.8431 L 242.96987,713.43685 L 241.25112,712.34309 L 240.46986,713.12434 L 241.87612,715.78061 L 242.03237,719.37437 L 240.93861,719.84312 L 239.06361,717.96812 L 237.03235,716.71811 L 237.5011,718.28062 L 238.7511,719.99938 L 237.96985,720.78063 C 237.96985,720.78063 237.1886,720.46813 236.71985,719.84312 C 236.25109,719.21812 234.68859,716.56186 234.68859,716.56186 L 233.75108,714.37435 C 233.75108,714.37435 233.43858,715.62436 232.81358,715.31185 C 232.18857,714.99935 231.56357,713.9056 231.56357,713.9056 L 233.28233,712.03059 L 231.87607,710.62433 L 231.87607,705.78056 L 231.09482,705.78056 L 230.31357,709.06182 L 229.21981,709.53058 L 228.28231,705.93681 L 227.6573,702.34304 L 226.87605,701.87429 L 227.18855,707.34307 L 227.18855,708.43682 L 225.78229,707.18682 L 222.34478,701.40554 L 220.31352,700.93679 L 219.68852,697.34302 L 218.12601,694.53051 L 216.5635,693.43675 L 216.5635,691.24924 L 218.59476,689.99924 L 218.12601,689.68674 L 215.626,690.31174 L 212.34473,687.96798 L 209.84472,685.15546 L 205.1572,682.65545 L 201.25093,680.15544 L 202.50094,677.03043 L 202.50094,675.46792 L 200.78218,677.03043 L 197.96967,678.12418 L 194.3759,677.03043 L 188.90712,674.68667 L 183.5946,674.68667 L 182.9696,675.15542 L 176.71957,671.4054 L 174.68831,671.0929 L 172.03205,665.46787 L 168.59453,665.78037 L 165.15701,667.18663 L 165.62577,671.56165 L 166.71952,668.74914 L 167.65703,669.06164 L 166.25077,673.28041 L 169.37578,670.62415 L 170.00079,672.18665 L 166.25077,676.40542 L 165.00076,676.09292 L 164.53201,674.21791 L 163.28201,673.43666 L 162.032,674.53042 L 159.37574,672.81166 L 156.40697,674.84292 L 154.68822,676.87418 L 151.40695,678.90544 L 146.87568,678.74918 L 146.40693,676.71793 L 150.00069,676.09292 L 150.00069,674.84292 L 147.81318,674.21791 L 148.75069,671.87415 L 150.9382,668.12414 L 150.9382,666.40538 L 151.09445,665.62412 L 155.31322,663.43661 L 156.25072,664.68662 L 158.90699,664.68662 L 157.65698,662.18661 L 154.06321,661.87411 L 149.21944,664.53037 L 146.87568,667.81163 L 145.15692,670.31165 L 144.06317,672.49916 L 140.00065,673.90541 L 137.03188,676.40542 L 136.71938,677.96793 L 138.90689,678.90544 L 139.68815,680.93669 L 137.03188,684.06171 L 130.78186,688.12423 L 123.28182,692.18675 L 121.25056,693.2805 L 116.09429,694.37426 L 110.93801,696.56177 L 112.65677,697.81177 L 111.25051,699.21803 L 110.78176,700.31178 L 108.1255,699.37428 L 105.00049,699.53053 L 104.21923,701.71804 L 103.28173,701.71804 L 103.59423,699.37428 L 100.15671,700.62429 L 97.3442,701.56179 L 94.062935,700.31178 L 91.250422,702.18679 L 88.125408,702.18679 L 86.094148,703.4368 L 84.531641,704.21805 L 82.500382,703.90555 L 80.00037,702.8118 L 77.81286,703.4368 L 76.875356,704.3743 L 75.312848,703.28055 L 75.312848,701.40554 L 78.281612,700.15553 L 84.37539,700.78054 L 88.59416,699.21803 L 90.625419,697.18677 L 93.437932,696.56177 L 95.15669,695.78051 L 97.812953,695.93676 L 99.37546,697.18677 L 100.31296,696.87427 L 102.50047,694.21801 L 105.46924,693.2805 L 108.7505,692.6555 L 110.00051,692.343 L 110.62551,692.81175 L 111.40677,692.81175 L 112.65677,689.21798 L 116.56304,687.81173 L 118.43805,684.21796 L 120.62556,679.84294 L 122.18807,678.43668 L 122.50057,675.93667 L 120.93806,677.18668 L 117.65679,677.81168 L 117.03179,675.46792 L 115.78179,675.15542 L 114.84428,676.09292 L 114.68803,678.90544 L 113.28177,678.74918 L 111.87552,673.12416 L 110.62551,674.37416 L 109.53176,673.90541 L 109.21926,672.0304 L 105.31299,672.18665 L 103.28173,673.28041 L 100.78172,672.96791 L 102.18797,671.56165 L 102.65672,669.06164 L 102.03172,667.18663 L 103.43798,666.24913 L 104.68798,666.09288 L 104.06298,664.37412 L 104.06298,660.15535 L 103.12548,659.21784 L 102.34422,660.6241 L 96.406696,660.6241 L 95.00044,659.37409 L 94.375437,655.62408 L 92.344177,652.18656 L 92.344177,651.24906 L 94.375437,650.4678 L 94.531687,648.43654 L 95.625442,647.34279 L 94.844189,646.87404 L 93.594183,647.34279 L 92.500428,644.68653 L 93.437932,639.84275 L 97.812953,636.71774 L 100.31296,635.15523 L 102.18797,631.56147 L 104.84424,630.31146 L 107.34425,631.40522 L 107.65675,633.74898 L 110.00051,633.43647 L 113.12552,631.09271 L 114.68803,631.71772 L 115.62553,632.34272 L 117.18804,632.34272 L 119.37555,631.09271 L 120.15681,626.87394 C 120.15681,626.87394 120.46931,624.06143 121.09431,623.59268 C 121.71931,623.12393 122.03181,622.65518 122.03181,622.65518 L 120.93806,620.78017 L 118.43805,621.56142 L 115.31303,622.34267 L 113.43802,621.87392 L 110.00051,620.15516 L 105.15674,619.99891 L 101.71922,616.40515 L 102.18797,612.65513 L 102.81298,610.31137 L 100.78172,608.59261 L 98.906708,604.99884 L 99.37546,604.21759 L 105.93799,603.74884 L 107.96925,603.74884 L 108.90675,604.68634 L 109.53176,604.68634 L 109.37551,603.12383 L 113.12552,602.49883 L 115.62553,602.81133 L 117.03179,603.90509 L 115.62553,605.93635 L 115.15678,607.3426 L 117.81305,608.90511 L 122.65682,610.62387 L 124.37558,609.68637 L 122.18807,605.4676 L 121.25056,602.34258 L 122.18807,601.56133 L 118.9068,599.68632 L 118.43805,598.59256 L 118.9068,597.03006 L 118.12555,593.28004 L 115.31303,588.74877 L 112.96927,584.68625 L 115.78179,582.81124 L 118.9068,582.81124 L 120.62556,583.43624 L 124.68808,583.27999 L 128.28184,579.84248 L 129.3756,576.87371 L 132.96937,574.52995 L 134.53187,575.46746 L 137.18813,574.84245 L 140.7819,572.81119 L 141.87566,572.65494 L 142.81316,573.4362 L 147.18818,573.27995 L 149.84444,570.31118 L 150.9382,570.31118 L 154.37571,572.65494 L 156.25072,574.6862 L 155.78197,575.77996 L 156.40697,576.87371 L 157.96948,575.31121 L 161.7195,575.62371 L 162.032,579.21747 L 163.90701,580.62373 L 170.78204,581.24873 L 176.87582,585.31125 L 178.28207,584.37375 L 183.2821,586.87376 L 185.31336,586.24876 L 187.18837,585.4675 L 191.87589,587.34251 L 196.09466,590.15502 M 196.09466,590.15502 L 195.78216,672.65541 L 197.34466,673.59291 L 200.31343,673.74916 L 201.71968,672.65541 L 204.21969,672.65541 L 204.37595,675.46792 L 211.09473,682.03045 L 211.56348,684.53046 L 214.84474,682.65545 L 215.46975,682.4992 L 215.78225,679.53044 L 217.1885,677.96793 L 218.28226,677.81168 L 220.15727,676.40542 L 223.12603,678.43668 L 223.75104,681.2492 L 225.62604,682.34295 L 226.7198,684.68671 L 230.46982,686.40547 L 233.75108,692.18675 L 236.40734,695.93676 L 238.59485,698.59303 L 240.00111,702.18679 L 244.84488,703.90555 L 249.84491,705.93681 L 250.78241,710.15558 L 251.25116,713.12434 L 250.31366,716.40561 L 248.28239,719.14001",
    'FL' : "M 747.96137,581.40584 L 749.98034,589.3338 L 753.58521,598.75 L 758.74146,607.8125 L 762.33521,613.90625 L 767.02271,619.21875 L 770.92896,622.8125 L 772.49146,625.625 L 771.39771,626.875 L 770.61646,628.125 L 773.42896,635.3125 L 776.24146,638.125 L 778.74146,643.28125 L 782.17896,648.90625 L 786.55396,656.875 L 787.80396,664.21875 L 788.27271,675.78125 L 788.89771,677.5 L 788.58521,680.78125 L 786.24146,682.03125 L 786.55396,683.90625 L 785.92896,685.78125 L 786.24146,688.125 L 786.71021,690 L 784.05396,693.125 L 781.08521,694.53125 L 777.33521,694.6875 L 775.92896,696.25 L 773.58521,697.1875 L 772.33521,696.71875 L 771.24146,695.78125 L 770.92896,692.96875 L 770.14771,689.6875 L 766.86646,684.6875 L 763.42896,682.5 L 759.67896,682.1875 L 758.89771,683.4375 L 755.92896,679.21875 L 755.30396,675.78125 L 752.80396,671.875 L 751.08521,670.78125 L 749.52271,672.8125 L 747.80396,672.5 L 745.77271,667.65625 L 742.96021,663.90625 L 740.14771,658.75 L 737.64771,655.78125 L 734.21021,652.1875 L 736.24146,649.84375 L 739.36646,644.53125 L 739.21021,642.96875 L 734.83521,642.03125 L 733.27271,642.65625 L 733.58521,643.28125 L 736.08521,644.21875 L 734.67896,648.59375 L 733.89771,649.0625 L 732.17896,645.15625 L 730.92896,640.46875 L 730.61646,637.8125 L 732.02271,633.28125 L 732.02271,624.0625 L 729.05396,620.46875 L 727.80396,617.5 L 722.80396,616.25 L 720.92896,615.625 L 719.36646,613.125 L 716.08521,611.5625 L 714.99146,608.28125 L 712.33521,607.34375 L 709.99146,603.75 L 705.92896,602.34375 L 703.11646,600.9375 L 700.61646,600.9375 L 696.71021,601.71875 L 696.55396,603.59375 L 697.33521,604.53125 L 696.86646,605.625 L 693.89771,605.46875 L 690.30396,608.90625 L 686.86646,610.78125 L 683.11646,610.78125 L 679.99146,612.03125 L 679.67896,609.375 L 678.11646,607.5 L 675.30396,606.40625 L 673.74146,605 L 665.92896,601.25 L 658.58521,599.53125 L 654.36646,600.15625 L 648.58521,600.625 L 642.80396,602.65625 L 639.44116,603.2487 L 639.2112,595.46836 L 636.7112,593.59336 L 634.99245,591.87461 L 635.30495,588.90585 L 645.14871,587.65585 L 669.83625,584.84335 L 676.39876,584.21835 L 682.33627,584.06209 L 684.83627,587.8121 L 686.24252,589.21835 L 693.89879,589.3746 L 704.35642,588.7496 L 725.14883,587.4996 L 730.41229,586.8478 L 734.83635,586.8746 L 734.9926,589.6871 L 737.4926,590.46835 L 737.8051,586.2496 L 736.2426,581.87459 L 737.33635,580.31209 L 742.96136,581.09334 L 747.96137,581.40584 z M 759.91605,710.23387 L 762.25981,709.60887 L 763.50981,709.3745 L 764.91607,707.10886 L 767.1817,705.54636 L 768.43171,706.01511 L 770.07234,706.32761 L 770.46296,707.34324 L 767.10358,708.51512 L 763.04106,709.92137 L 760.77543,711.09325 L 759.91605,710.23387 z M 772.96297,705.39011 L 774.13485,706.40574 L 776.79111,704.37448 L 781.94738,700.31197 L 785.54114,696.56195 L 787.96302,690.15568 L 788.90053,688.51505 L 789.05678,685.23379 L 788.35365,685.70254 L 787.41615,688.43692 L 786.00989,692.89006 L 782.88488,697.96821 L 778.66612,702.03072 L 775.38486,703.90573 L 772.96297,705.39011 z"
};
    function drawState(state, color) {
        if (!color) {
            color = '#FF0000';
        }
        var translation = [0,0];
        //if (state == 'HI' || state == 'AK') {
        translation = scalePoint([-43.12533, -131.9412]);
        //}
        //alert('state: ' + state + ', translation ' + translation);
        drawSvgPath(stateData[state], translation, color);
    }
    function scalePoint(point) {
        return point.map(function(x) { return x * (800.0/958.69);});
    }
    function getPoint(point) {
        var tempPoint = point.split(',').map(function(x) {return parseFloat(x);});
        // Scale it.
        return scalePoint(tempPoint);
    }
    function drawSvgPath(data, translation, color) {
        var commands = data.split(' ');
        var index = 0;
        var curPoint = [0,0];
        ctx.strokeStyle = "black";
        ctx.lineWidth = 1;
        ctx.fillStyle = color;

        /*ctx.beginPath();
        ctx.moveTo(300.5, 300.5);
        ctx.lineTo(500, 300.5);
        ctx.lineTo(500.5, 500.5);
        ctx.fill();*/

        ctx.save();
        if (!(translation[0] == 0 && translation[1] == 0)) {
            ctx.translate(translation[0], translation[1]);
            //alert('translated ' + translation);
        }
        ctx.beginPath();
        while (index < commands.length) {
            var command = commands[index++];
            switch (command) {
                case 'M':
                    // Move
                    var pointCoords = getPoint(commands[index++]);
                    ctx.moveTo(pointCoords[0], pointCoords[1]);
                    //alert('m ' + pointCoords[0] + ' ' + pointCoords[1]);
                    curPoint = [pointCoords[0], pointCoords[1]];
                    break;
                case 'L':
                    // Straight line
                    var pointCoords = getPoint(commands[index++]);
                    ctx.lineTo(pointCoords[0], pointCoords[1]);
                    //alert('L ' + pointCoords[0] + ' ' + pointCoords[1]);
                    curPoint = [pointCoords[0], pointCoords[1]];
                    break;
                case 'C':
                    // Cubic Bezier curve
                    var point1 = getPoint(commands[index++]);
                    var point2 = getPoint(commands[index++]);
                    var point3 = getPoint(commands[index++]);
                    ctx.bezierCurveTo(point1[0], point1[1], point2[0], point2[1], point3[0], point3[1]);
                    //alert('C ' + pointCoords[0] + ' ' + pointCoords[1]);
                    curPoint = [point3[0], point3[1]];
                    break;
 
                case 'z':
                    // Close path
                    // TODO - filling, stuff go here.
                    ctx.closePath();
                    ctx.stroke();
                    ctx.fill();
                    ctx.beginPath();
                    break;
                case '':
                    // just at end of string, no worries
                    break;
                default:
                    alert('unknown command "' + command + '" at position ' + index + ' (curPoint ' + curPoint + ')');
                    index = commands.length;
            }
        }
        ctx.stroke();
        ctx.fill();
        ctx.restore();
    }
    $(document).ready(function() {
        var canvas = document.getElementById('mapCanvas');
        ctx = canvas.getContext('2d');
        //mapImage = new Image();
        //$(mapImage).load(imageLoaded);
        //mapImage.src = 'svg/largemap.png';
        // TODO - click handler?
        //canvas.addEventListener('mouseup', ev_canvas, false);
        for (var stateName in stateData) {
            drawState(stateName);
        }
        //drawState('HI');


    });
   </script>
 
</body>
</html>
